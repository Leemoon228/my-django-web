let burger = document.querySelector(".header__menu-btn"),
    close = document.querySelector(".close-btn"),
    menu = document.querySelector(".header__menu");


burger.addEventListener("click", function () {
    (menu.style.display = "block"), (menu.style.animation = "menu-down 0.5s forwards");
});

let hideMenu = function () {
    menu.style.display = "none";
};

close.addEventListener("click", function () {
    (menu.style.animation = "menu-up 0.5s forwards"), setTimeout(hideMenu, 500);
});

const form = document.getElementById('form');
const search = document.getElementById('search');
const result = document.getElementById('result');

form.addEventListener('submit', e=> {
    e.preventDefault();
    searchValue = search.value.trim();
    if(!searchValue){
        alert("Вы ничего не ввели для поиска")
    }
    else{
        searchSong(searchValue);
    }
})

const searchOnKeyUp =() =>{
    searchValue = search.value.trim();
    searchSong(searchValue)
}

result.addEventListener('click', e=>{
    const clickedElement = e.target;

    if (clickedElement.tagName === 'SPAN'){
        const artist = clickedElement.getAttribute('data-artist');
        const songTitle = clickedElement.getAttribute('data-songtitle');

        execute(artist, songTitle)
    }
})


gapi.load("client", loadClient);

function loadClient() {
    gapi.client.setApiKey("AIzaSyBSzjQc0gpoVu9Jh8MXY8upWcIP4YHCVE8");
    return gapi.client.load("https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest")
        .then(function() { console.log("GAPI client loaded for API"); },
            function(err) { console.error("Error loading GAPI client for API", err); });
};


const execute = (artist, songTitle)=>{
    var arr_search = {
        "part": 'snippet',
        "type": 'video',
        "order": 'relevance',
        "maxResults": 1,
        "q": songTitle + artist
    };

    arr_search.pageToken = ``;

    return gapi.client.youtube.search.list(arr_search)
        .then(function(response) {
                const listItems = response.result.items;
                if (listItems) {
                    let output = ``;

                    listItems.forEach(item => {
                        const videoId = item.id.videoId;
                        const videoTitle = item.snippet.title;
                        output += `https://www.youtube.com/embed/${videoId}`;
                    });
                    output += '';

                    document.getElementById('video').src = output
                    document.getElementById('video-container').className = "thumb-wrap"

                }
            },
            function(err) { console.error("Execute error", err); });
}



var lastfm = new LastFM({
    apiKey    : '31e332f964616a2d6c7c6ecfc6cb55c7',
    apiSecret : 'fa02266db89e7a5e20c13ac639dd36b2'
});

async function searchSong(searchValue){
     lastfm.track.search({track: `${searchValue}`}, {success: function(data){
             console.log(data);
             showData(data);
         }, error: function(code, message){
             console.log(`${code} ` + `${message}`);
         }});
}

function showData(data){
    result.innerHTML = `
    <ul class="song-list">
      ${data.results.trackmatches.track
        .map(track=> `<li>
                    <div style="margin-bottom: 7px">
                        <strong>${track.artist}</strong> - ${track.name} 
                    </div>
                    <span data-artist="${track.artist}" data-songtitle="${track.name}"> Найти видео </span>
                </li>`
        )
        .join('')}
    </ul>
  `;
}

function submitform()
{
document.getElementById("LogInOrOut").submit();
}